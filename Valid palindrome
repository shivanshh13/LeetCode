#include <stdbool.h>
#include <string.h>
#include <ctype.h>

/**
 * @brief Checks if a string is a palindrome according to the rules:
 * 1. Convert all uppercase letters to lowercase.
 * 2. Remove all non-alphanumeric characters.
 * @param s The input string.
 * @return true if the string is a palindrome, false otherwise.
 */
bool isPalindrome(char *s) {
    // If the input string pointer is NULL, it can be considered a palindrome.
    // Based on constraints (1 <= s.length), this check is mostly for robustness.
    if (s == NULL) {
        return true;
    }

    int left = 0;
    // Calculate the length of the string to set the right pointer.
    int right = strlen(s) - 1;

    // Use a two-pointer approach, moving inwards from both ends.
    while (left < right) {
        // 1. Move the left pointer past any non-alphanumeric characters.
        // We must check 'left < right' condition in the inner loop as well, 
        // to prevent overshooting when the string is entirely non-alphanumeric.
        while (left < right && !isalnum(s[left])) {
            left++;
        }

        // 2. Move the right pointer past any non-alphanumeric characters.
        while (left < right && !isalnum(s[right])) {
            right--;
        }

        // 3. Comparison step: If the pointers haven't crossed, compare the characters.
        if (left < right) {
            // Compare characters after converting them to lowercase.
            if (tolower(s[left]) != tolower(s[right])) {
                return false; // Not a palindrome
            }
            
            // Move both pointers inward for the next comparison.
            left++;
            right--;
        }
    }

    // If the loop completes without finding any mismatch, it is a palindrome.
    return true;
}

// NOTE: The 'main' function and test cases were removed to avoid the redefinition error
// when compiling against an external test harness.
